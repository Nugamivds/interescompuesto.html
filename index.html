<script>
    function updateUI() {
        const cap = parseFloat(document.getElementById('cap').value) || 0;
        const apo = parseFloat(document.getElementById('apo_mensual').value) || 0;
        const tna = (parseFloat(document.getElementById('tna').value) || 0) / 100;
        const yrs = parseFloat(document.getElementById('yrs').value) || 1;
        const tasaM = tna / 12;
        
        const gDiariaActual = (cap * tna) / 365;
        document.getElementById('daily-value').innerText = gDiariaActual.toLocaleString('es-AR', {style:'currency', currency:'ARS'}) + " / día";

        let mesesP = Math.floor(yrs * 12);
        let labels = [], dataPuro = [], dataCompuesto = [];
        let sCompuesto = cap, aPuro = cap;

        for (let i = 0; i <= mesesP; i++) {
            labels.push(i);
            dataPuro.push(aPuro);
            dataCompuesto.push(sCompuesto);
            sCompuesto = (sCompuesto + apo) * (1 + tasaM);
            aPuro += apo;
        }

        // Gráfico (se mantiene igual)
        const ctx = document.getElementById('myChart').getContext('2d');
        if (myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels,
                datasets: [
                    { label: 'Compuesto', data: dataCompuesto, borderColor: '#00ff88', tension: 0.3, fill: false, pointRadius: 0, pointHitRadius: 15 },
                    { label: 'Puro', data: dataPuro, borderColor: '#64748b', tension: 0, borderDash: [5, 5], fill: false, pointRadius: 0 }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        enabled: true,
                        backgroundColor: 'rgba(11, 15, 26, 0.95)',
                        callbacks: {
                            title: (items) => `Mes ${items[0].label} (Año ${Math.floor(items[0].label/12)})`,
                            label: (item) => `${item.dataset.label}: ${item.parsed.y.toLocaleString('es-AR', {style:'currency', currency:'ARS'})}`
                        }
                    }
                },
                scales: { y: { ticks: { color: '#64748b', font: { size: 9 } }, grid: { color: '#1e293b' } }, x: { display: false } }
            }
        });

        // --- LÓGICA DE METAS MEJORADA ---
        const list = document.getElementById('goals-list');
        list.innerHTML = '';
        const ganFinal = (sCompuesto * tna) / 365;
        
        let m = 100;
        while (m <= ganFinal) {
            // Solo procesar si la meta es relevante para la vista actual (cercana a la actual o futura)
            if (m >= gDiariaActual - 200) {
                let div = document.createElement('div');
                let mCount = 0, sTemp = cap;
                let lograda = gDiariaActual >= m;

                if (!lograda) {
                    while ((sTemp * tna / 365) < m && mCount < mesesP) {
                        sTemp = (sTemp + apo) * (1 + tasaM); mCount++;
                    }
                }

                // Solo mostrar si se alcanza dentro de la proyección o si ya está lograda
                if (lograda || mCount < mesesP) {
                    div.className = 'goal-item ' + (lograda ? 'reached' : '');
                    div.innerHTML = `<div style="color:${lograda?'var(--p)':'var(--accent)'}; font-weight:bold;">$${m.toLocaleString()}</div>
                                     <div style="font-size:10px; opacity:0.6">${lograda?'¡Logrado!':'En '+mCount+' meses'}</div>`;
                    list.appendChild(div);
                }
            }

            // --- REGLA DE INCREMENTO SOLICITADA ---
            if (m < 10000) {
                m += 100; // De 100 en 100 hasta los 10k
            } else {
                // Después de los 10k, saltos "aleatorios" controlados para no colapsar la UI
                // Aumenta el salto gradualmente según el volumen de dinero
                if (m < 50000) m += 5000;
                else if (m < 200000) m += 20000;
                else m += 100000;
            }
        }
    }
</script>
